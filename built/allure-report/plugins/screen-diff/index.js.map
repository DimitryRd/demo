{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../allure-report/plugins/screen-diff/index.js"],"names":[],"mappings":"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","sourcesContent":["(function () {\n    var settings = allure.getPluginSettings('screen-diff', {diffType: 'diff'});\n\n    function renderImage(src) {\n        return '<div class=\"screen-diff__container\">' +\n            '<img class=\"screen-diff__image\" src=\"data/attachments/' + src + '\">' +\n            '</div>';\n    }\n\n    function renderDiffContent(type, data) {\n        function findImage(name) {\n            if (data.testStage && data.testStage.attachments) {\n                return data.testStage.attachments.filter(function (attachment) {\n                    return attachment.name === name;\n                })[0];\n            }\n            return null;\n        }\n\n        var diffImage = findImage('diff');\n        var actualImage = findImage('actual');\n        var expectedImage = findImage('expected');\n\n        if (!diffImage && !actualImage && !expectedImage) {\n            return '<span>Diff, actual and expected image have not been provided.</span>';\n        }\n\n        if (type === 'diff') {\n            if (!diffImage) {\n                return renderImage(actualImage.source);\n            }\n            return renderImage(diffImage.source);\n        }\n        if (type === 'overlay') {\n            return '<div class=\"screen-diff__overlay screen-diff__container\">' +\n                '<img class=\"screen-diff__image\" src=\"data/attachments/' + expectedImage.source + '\">' +\n                '<div class=\"screen-diff__image-over\">' +\n                '<img class=\"screen-diff__image\" src=\"data/attachments/' + actualImage.source + '\">' +\n                '</div>' +\n                '</div>';\n        }\n    }\n\n    var ScreenDiffView = Backbone.Marionette.View.extend({\n        className: 'pane__section',\n        events: {\n            'click [name=\"screen-diff-type\"]': 'onDiffTypeChange',\n            'mousemove .screen-diff__overlay': 'onOverlayMove'\n        },\n        templateContext: function () {\n            return {\n                diffType: settings.get('diffType')\n            }\n        },\n        template: function (data) {\n            var testType = data.labels.filter(function (label) {\n                return label.name === 'testType'\n            })[0];\n\n            if (!testType || testType.value !== 'screenshotDiff') {\n                return '';\n            }\n\n            return '<h3 class=\"pane__section-title\">Screen Diff</h3>' +\n                '<div class=\"screen-diff__content\">' +\n                '<div class=\"screen-diff__switchers\">' +\n                '<label><input type=\"radio\" name=\"screen-diff-type\" value=\"diff\"> Show diff</label>' +\n                '<label><input type=\"radio\" name=\"screen-diff-type\" value=\"overlay\"> Show overlay</label>' +\n                '</div>' +\n                renderDiffContent(data.diffType, data) +\n                '</div>';\n        },\n        adjustImageSize: function (event) {\n            var overImage = this.$(event.target);\n            overImage.width(overImage.width());\n        },\n        onRender: function () {\n            const diffType = settings.get('diffType');\n            this.$('[name=\"screen-diff-type\"][value=\"' + diffType + '\"]').prop('checked', true);\n            if (diffType === 'overlay') {\n                this.$('.screen-diff__image-over img').on('load', this.adjustImageSize.bind(this));\n            }\n        },\n        onOverlayMove: function (event) {\n            var pageX = event.pageX;\n            var containerScroll = this.$('.screen-diff__container').scrollLeft();\n            var elementX = event.currentTarget.getBoundingClientRect().left;\n            var delta = pageX - elementX + containerScroll;\n            this.$('.screen-diff__image-over').width(delta);\n        },\n        onDiffTypeChange: function (event) {\n            settings.save('diffType', event.target.value);\n            this.render();\n        }\n    });\n    allure.api.addTestResultBlock(ScreenDiffView, {position: 'before'});\n})();\n"]}